#include "vulkanunit.h"

#include <kore3/gpu/device.h>

#include <assert.h>
#include <string.h>

static VkFormat convert_to_vulkan_format(kore_gpu_texture_format format) {
	switch (format) {
	case KORE_GPU_TEXTURE_FORMAT_UNDEFINED:
		return VK_FORMAT_UNDEFINED;
	case KORE_GPU_TEXTURE_FORMAT_R8_UNORM:
		return VK_FORMAT_R8_UNORM;
	case KORE_GPU_TEXTURE_FORMAT_R8_SNORM:
		return VK_FORMAT_R8_SNORM;
	case KORE_GPU_TEXTURE_FORMAT_R8_UINT:
		return VK_FORMAT_R8_UINT;
	case KORE_GPU_TEXTURE_FORMAT_R8_SINT:
		return VK_FORMAT_R8_SINT;
	case KORE_GPU_TEXTURE_FORMAT_R16_UINT:
		return VK_FORMAT_R16_UINT;
	case KORE_GPU_TEXTURE_FORMAT_R16_SINT:
		return VK_FORMAT_R16_SINT;
	case KORE_GPU_TEXTURE_FORMAT_R16_FLOAT:
		return VK_FORMAT_R16_SFLOAT;
	case KORE_GPU_TEXTURE_FORMAT_RG8_UNORM:
		return VK_FORMAT_R8G8_UNORM;
	case KORE_GPU_TEXTURE_FORMAT_RG8_SNORM:
		return VK_FORMAT_R8G8_SNORM;
	case KORE_GPU_TEXTURE_FORMAT_RG8_UINT:
		return VK_FORMAT_R8G8_UINT;
	case KORE_GPU_TEXTURE_FORMAT_RG8_SINT:
		return VK_FORMAT_R8G8_SINT;
	case KORE_GPU_TEXTURE_FORMAT_R32_UINT:
		return VK_FORMAT_R32_UINT;
	case KORE_GPU_TEXTURE_FORMAT_R32_SINT:
		return VK_FORMAT_R32_SINT;
	case KORE_GPU_TEXTURE_FORMAT_R32_FLOAT:
		return VK_FORMAT_R32_SFLOAT;
	case KORE_GPU_TEXTURE_FORMAT_RG16_UINT:
		return VK_FORMAT_R16G16_UINT;
	case KORE_GPU_TEXTURE_FORMAT_RG16_SINT:
		return VK_FORMAT_R16G16_SINT;
	case KORE_GPU_TEXTURE_FORMAT_RG16_FLOAT:
		return VK_FORMAT_R16G16_SFLOAT;
	case KORE_GPU_TEXTURE_FORMAT_RGBA8_UNORM:
		return VK_FORMAT_R8G8B8A8_UNORM;
	case KORE_GPU_TEXTURE_FORMAT_RGBA8_UNORM_SRGB:
		return VK_FORMAT_R8G8B8A8_SRGB;
	case KORE_GPU_TEXTURE_FORMAT_RGBA8_SNORM:
		return VK_FORMAT_R8G8B8A8_SNORM;
	case KORE_GPU_TEXTURE_FORMAT_RGBA8_UINT:
		return VK_FORMAT_R8G8B8A8_UINT;
	case KORE_GPU_TEXTURE_FORMAT_RGBA8_SINT:
		return VK_FORMAT_R8G8B8A8_SINT;
	case KORE_GPU_TEXTURE_FORMAT_BGRA8_UNORM:
		return VK_FORMAT_B8G8R8A8_UNORM;
	case KORE_GPU_TEXTURE_FORMAT_BGRA8_UNORM_SRGB:
		return VK_FORMAT_B8G8R8A8_SRGB;
	case KORE_GPU_TEXTURE_FORMAT_RGB9E5U_FLOAT:
		return VK_FORMAT_E5B9G9R9_UFLOAT_PACK32;
	case KORE_GPU_TEXTURE_FORMAT_RGB10A2_UINT:
		return VK_FORMAT_A2R10G10B10_UINT_PACK32;
	case KORE_GPU_TEXTURE_FORMAT_RGB10A2_UNORM:
		return VK_FORMAT_A2R10G10B10_UNORM_PACK32;
	case KORE_GPU_TEXTURE_FORMAT_RG11B10U_FLOAT:
		return VK_FORMAT_B10G11R11_UFLOAT_PACK32;
	case KORE_GPU_TEXTURE_FORMAT_RG32_UINT:
		return VK_FORMAT_R32G32_UINT;
	case KORE_GPU_TEXTURE_FORMAT_RG32_SINT:
		return VK_FORMAT_R32G32_SINT;
	case KORE_GPU_TEXTURE_FORMAT_RG32_FLOAT:
		return VK_FORMAT_R32G32_SFLOAT;
	case KORE_GPU_TEXTURE_FORMAT_RGBA16_UINT:
		return VK_FORMAT_R16G16B16A16_UINT;
	case KORE_GPU_TEXTURE_FORMAT_RGBA16_SINT:
		return VK_FORMAT_R16G16B16A16_SINT;
	case KORE_GPU_TEXTURE_FORMAT_RGBA16_FLOAT:
		return VK_FORMAT_R16G16B16A16_SFLOAT;
	case KORE_GPU_TEXTURE_FORMAT_RGBA32_UINT:
		return VK_FORMAT_R32G32B32A32_UINT;
	case KORE_GPU_TEXTURE_FORMAT_RGBA32_SINT:
		return VK_FORMAT_R32G32B32A32_SINT;
	case KORE_GPU_TEXTURE_FORMAT_RGBA32_FLOAT:
		return VK_FORMAT_R32G32B32A32_SFLOAT;
	case KORE_GPU_TEXTURE_FORMAT_DEPTH16_UNORM:
		return VK_FORMAT_D16_UNORM;
	case KORE_GPU_TEXTURE_FORMAT_DEPTH24_NOTHING8:
		return VK_FORMAT_X8_D24_UNORM_PACK32;
	case KORE_GPU_TEXTURE_FORMAT_DEPTH24_STENCIL8:
		return VK_FORMAT_D24_UNORM_S8_UINT;
	case KORE_GPU_TEXTURE_FORMAT_DEPTH32_FLOAT:
		return VK_FORMAT_D32_SFLOAT;
	case KORE_GPU_TEXTURE_FORMAT_DEPTH32_FLOAT_STENCIL8_NOTHING24:
		return VK_FORMAT_D32_SFLOAT_S8_UINT;
	}

	assert(false);
	return VK_FORMAT_R8G8B8A8_UNORM;
}

static kore_gpu_texture_format convert_from_vulkan_format(VkFormat format) {
	switch (format) {
	case VK_FORMAT_UNDEFINED:
		return KORE_GPU_TEXTURE_FORMAT_UNDEFINED;
	case VK_FORMAT_R8_UNORM:
		return KORE_GPU_TEXTURE_FORMAT_R8_UNORM;
	case VK_FORMAT_R8_SNORM:
		return KORE_GPU_TEXTURE_FORMAT_R8_SNORM;
	case VK_FORMAT_R8_UINT:
		return KORE_GPU_TEXTURE_FORMAT_R8_UINT;
	case VK_FORMAT_R8_SINT:
		return KORE_GPU_TEXTURE_FORMAT_R8_SINT;
	case VK_FORMAT_R16_UINT:
		return KORE_GPU_TEXTURE_FORMAT_R16_UINT;
	case VK_FORMAT_R16_SINT:
		return KORE_GPU_TEXTURE_FORMAT_R16_SINT;
	case VK_FORMAT_R16_SFLOAT:
		return KORE_GPU_TEXTURE_FORMAT_R16_FLOAT;
	case VK_FORMAT_R8G8_UNORM:
		return KORE_GPU_TEXTURE_FORMAT_RG8_UNORM;
	case VK_FORMAT_R8G8_SNORM:
		return KORE_GPU_TEXTURE_FORMAT_RG8_SNORM;
	case VK_FORMAT_R8G8_UINT:
		return KORE_GPU_TEXTURE_FORMAT_RG8_UINT;
	case VK_FORMAT_R8G8_SINT:
		return KORE_GPU_TEXTURE_FORMAT_RG8_SINT;
	case VK_FORMAT_R32_UINT:
		return KORE_GPU_TEXTURE_FORMAT_R32_UINT;
	case VK_FORMAT_R32_SINT:
		return KORE_GPU_TEXTURE_FORMAT_R32_SINT;
	case VK_FORMAT_R32_SFLOAT:
		return KORE_GPU_TEXTURE_FORMAT_R32_FLOAT;
	case VK_FORMAT_R16G16_UINT:
		return KORE_GPU_TEXTURE_FORMAT_RG16_UINT;
	case VK_FORMAT_R16G16_SINT:
		return KORE_GPU_TEXTURE_FORMAT_RG16_SINT;
	case VK_FORMAT_R16G16_SFLOAT:
		return KORE_GPU_TEXTURE_FORMAT_RG16_FLOAT;
	case VK_FORMAT_R8G8B8A8_UNORM:
		return KORE_GPU_TEXTURE_FORMAT_RGBA8_UNORM;
	case VK_FORMAT_R8G8B8A8_SRGB:
		return KORE_GPU_TEXTURE_FORMAT_RGBA8_UNORM_SRGB;
	case VK_FORMAT_R8G8B8A8_SNORM:
		return KORE_GPU_TEXTURE_FORMAT_RGBA8_SNORM;
	case VK_FORMAT_R8G8B8A8_UINT:
		return KORE_GPU_TEXTURE_FORMAT_RGBA8_UINT;
	case VK_FORMAT_R8G8B8A8_SINT:
		return KORE_GPU_TEXTURE_FORMAT_RGBA8_SINT;
	case VK_FORMAT_B8G8R8A8_UNORM:
		return KORE_GPU_TEXTURE_FORMAT_BGRA8_UNORM;
	case VK_FORMAT_B8G8R8A8_SRGB:
		return KORE_GPU_TEXTURE_FORMAT_BGRA8_UNORM_SRGB;
	case VK_FORMAT_E5B9G9R9_UFLOAT_PACK32:
		return KORE_GPU_TEXTURE_FORMAT_RGB9E5U_FLOAT;
	case VK_FORMAT_A2R10G10B10_UINT_PACK32:
		return KORE_GPU_TEXTURE_FORMAT_RGB10A2_UINT;
	case VK_FORMAT_A2R10G10B10_UNORM_PACK32:
		return KORE_GPU_TEXTURE_FORMAT_RGB10A2_UNORM;
	case VK_FORMAT_B10G11R11_UFLOAT_PACK32:
		return KORE_GPU_TEXTURE_FORMAT_RG11B10U_FLOAT;
	case VK_FORMAT_R32G32_UINT:
		return KORE_GPU_TEXTURE_FORMAT_RG32_UINT;
	case VK_FORMAT_R32G32_SINT:
		return KORE_GPU_TEXTURE_FORMAT_RG32_SINT;
	case VK_FORMAT_R32G32_SFLOAT:
		return KORE_GPU_TEXTURE_FORMAT_RG32_FLOAT;
	case VK_FORMAT_R16G16B16A16_UINT:
		return KORE_GPU_TEXTURE_FORMAT_RGBA16_UINT;
	case VK_FORMAT_R16G16B16A16_SINT:
		return KORE_GPU_TEXTURE_FORMAT_RGBA16_SINT;
	case VK_FORMAT_R16G16B16A16_SFLOAT:
		return KORE_GPU_TEXTURE_FORMAT_RGBA16_FLOAT;
	case VK_FORMAT_R32G32B32A32_UINT:
		return KORE_GPU_TEXTURE_FORMAT_RGBA32_UINT;
	case VK_FORMAT_R32G32B32A32_SINT:
		return KORE_GPU_TEXTURE_FORMAT_RGBA32_SINT;
	case VK_FORMAT_R32G32B32A32_SFLOAT:
		return KORE_GPU_TEXTURE_FORMAT_RGBA32_FLOAT;
	case VK_FORMAT_D16_UNORM:
		return KORE_GPU_TEXTURE_FORMAT_DEPTH16_UNORM;
	case VK_FORMAT_X8_D24_UNORM_PACK32:
		return KORE_GPU_TEXTURE_FORMAT_DEPTH24_NOTHING8;
	case VK_FORMAT_D24_UNORM_S8_UINT:
		return KORE_GPU_TEXTURE_FORMAT_DEPTH24_STENCIL8;
	case VK_FORMAT_D32_SFLOAT:
		return KORE_GPU_TEXTURE_FORMAT_DEPTH32_FLOAT;
	case VK_FORMAT_D32_SFLOAT_S8_UINT:
		return KORE_GPU_TEXTURE_FORMAT_DEPTH32_FLOAT_STENCIL8_NOTHING24;
	}

	assert(false);
	return KORE_GPU_TEXTURE_FORMAT_RGBA8_UNORM;
}

#include "buffer.c"
#include "commandlist.c"
#include "descriptorset.c"
#include "device.c"
#include "pipeline.c"
#include "raytracing.c"
#include "renderpasses.c"
#include "sampler.c"
#include "texture.c"
